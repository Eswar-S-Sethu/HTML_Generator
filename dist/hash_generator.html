<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hash Generator | ToolStack</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #0B0C1D;
      color: white;
    }
    .drop-zone {
      border: 2px dashed #6c757d;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      transition: background-color 0.3s ease;
    }
    .drop-zone.dragover {
      background-color: rgba(108, 117, 125, 0.1);
    }
    .file-table td,
    .file-table th {
      font-size: 0.9rem;
    }
    .copy-btn {
      font-size: 0.75rem;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light custom-navbar border-bottom mb-5">
  <div class="container d-flex justify-content-between align-items-center">
    <a class="navbar-brand fw-bold me-auto" href="index.html">ToolStack</a>
  </div>
</nav>

<div class="container py-5">
  <h1 class="text-center mb-4">Hash Generator</h1>

  <div class="row mb-4">
    <div class="col-md-6 mx-auto">
      <label for="algoSelect" class="form-label">Select Hash Algorithm</label>
      <select id="algoSelect" class="form-select">
        <option value="md5">MD5</option>
        <option value="sha1">SHA-1</option>
        <option value="sha256" selected>SHA-256</option>
        <option value="sha512">SHA-512</option>
      </select>
    </div>
  </div>

  <!-- Drop zone -->
  <div class="drop-zone mb-4" id="dropZone">
    <p>Drag and drop files here or</p>
    <button class="btn btn-outline-light mt-2" onclick="document.getElementById('fileInput').click()">Select Files</button>
    <input type="file" id="fileInput" hidden multiple />
  </div>

  <!-- Results Table -->
  <div id="resultsContainer" class="table-responsive" style="display: none;">
    <table class="table table-dark table-striped file-table">
      <thead>
        <tr>
          <th>File</th>
          <th>Size</th>
          <th>Hash</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="resultsTableBody"></tbody>
    </table>
  </div>
</div>

<script type="module">
  import init, { hash_file_bytes } from './UnitConverter.js';

  await init();

  const algoSelect = document.getElementById("algoSelect");
  const fileInput = document.getElementById("fileInput");
  const dropZone = document.getElementById("dropZone");
  const resultsContainer = document.getElementById("resultsContainer");
  const resultsTableBody = document.getElementById("resultsTableBody");

  // Register file selector
  fileInput.addEventListener("change", () => {
    if (fileInput.files.length) {
      handleFiles(fileInput.files);
    }
  });

  // Register drag and drop
  dropZone.addEventListener("dragover", e => {
    e.preventDefault();
    dropZone.classList.add("dragover");
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
  });

  dropZone.addEventListener("drop", e => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    if (e.dataTransfer.files.length) {
      handleFiles(e.dataTransfer.files);
    }
  });

  function handleFiles(files) {
    resultsTableBody.innerHTML = "";
    resultsContainer.style.display = "block";

    for (const file of files) {
      const row = document.createElement("tr");

      const nameCell = document.createElement("td");
      nameCell.textContent = file.name;

      const sizeCell = document.createElement("td");
      sizeCell.textContent = (file.size / 1024).toFixed(2) + " KB";

      const hashCell = document.createElement("td");
      hashCell.textContent = "Computing...";

      const copyCell = document.createElement("td");
      const copyBtn = document.createElement("button");
      copyBtn.className = "btn btn-sm btn-outline-light copy-btn";
      copyBtn.textContent = "Copy";
      copyBtn.disabled = true;
      copyCell.appendChild(copyBtn);

      row.appendChild(nameCell);
      row.appendChild(sizeCell);
      row.appendChild(hashCell);
      row.appendChild(copyCell);
      resultsTableBody.appendChild(row);

      const reader = new FileReader();
      reader.onload = () => {
        const buffer = new Uint8Array(reader.result);
        const algo = algoSelect.value;

        try {
          const hash = hash_file_bytes(buffer, algo);
          hashCell.textContent = hash;
          copyBtn.disabled = false;

          copyBtn.onclick = () => {
            navigator.clipboard.writeText(hash);
            copyBtn.textContent = "Copied!";
            setTimeout(() => copyBtn.textContent = "Copy", 1000);
          };
        } catch (err) {
          hashCell.textContent = "Error hashing file.";
          console.error("Hash error:", err);
        }
      };
      reader.readAsArrayBuffer(file);
    }
  }
</script>
</body>
</html>
